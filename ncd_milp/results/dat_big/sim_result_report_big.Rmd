---
title: "Results Summary 2024-02-13"
author: "Yu Yan"
date: "2024-02-13"
header-includes:
  - \usepackage{placeins}
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)
knitr::opts_chunk$set(error = F)
knitr::opts_chunk$set(warning = F)
knitr::opts_chunk$set(message = F)

#knitr::opts_chunk$set(fig.width=8, fig.height=4) 
library(tidyverse)
library(kableExtra)
library(mice)
library(gtsummary)
library(psych)
library(ggridges)
library(writexl)
```


```{r}
# new algo result
new_alg <- testing_2024_2_19
# parameter columns
new_alg <- new_alg %>% mutate(p1 = unlist(lapply(new_alg$data, function(input_string) {
  split_string <- unlist(strsplit(input_string, "_"))
  return(split_string[3])
  })), 
                                   p2 = unlist(lapply(new_alg$data, function(input_string) {
  split_string <- unlist(strsplit(input_string, "_"))
  return(split_string[4])
  })),
                                   eps = unlist(lapply(new_alg$data, function(input_string) {
  split_string <- unlist(strsplit(input_string, "_"))
  return(split_string[5])
  })),
                                   link = unlist(lapply(new_alg$data, function(input_string) {
  split_string <- unlist(strsplit(input_string, "_"))
  return(split_string[6])
  })))
```

```{r}
# ncd result
ncd <- ncd_cv0_R_loop
# parameter columns
ncd <- ncd %>% mutate(p1 = unlist(lapply(ncd$data, function(input_string) {
  split_string <- unlist(strsplit(input_string, "_"))
  return(split_string[3])
  })), 
                                   p2 = unlist(lapply(ncd$data, function(input_string) {
  split_string <- unlist(strsplit(input_string, "_"))
  return(split_string[4])
  })),
                                   eps = unlist(lapply(ncd$data, function(input_string) {
  split_string <- unlist(strsplit(input_string, "_"))
  return(split_string[5])
  })),
                                   link = unlist(lapply(ncd$data, function(input_string) {
  split_string <- unlist(strsplit(input_string, "_"))
  return(split_string[6])
  })))
```

```{r}
# round logistic
logis <- results_ncd_fr_YY[results_ncd_fr_YY$method=='Round',]
indices <- match(new_alg$data,logis$data)
logis <- logis[indices,]
# parameter columns
logis <- logis %>% mutate(p1 = unlist(lapply(logis$data, function(input_string) {
  split_string <- unlist(strsplit(input_string, "_"))
  return(split_string[3])
  })), 
                                   p2 = unlist(lapply(logis$data, function(input_string) {
  split_string <- unlist(strsplit(input_string, "_"))
  return(split_string[4])
  })),
                                   eps = unlist(lapply(logis$data, function(input_string) {
  split_string <- unlist(strsplit(input_string, "_"))
  return(split_string[5])
  })),
                                   link = unlist(lapply(logis$data, function(input_string) {
  split_string <- unlist(strsplit(input_string, "_"))
  return(split_string[6])
  })))
```


```{r}
# acc comparison
acc_dat <- as.data.frame(cbind(new_alg$acc,ncd$acc,logis$acc,new_alg$link)) %>%
  set_names(c('new','ncd','logis','link')) %>%
  pivot_longer(c(new,ncd,logis), names_to = 'alg',values_to = 'acc') %>%
  mutate(acc=as.numeric(acc),alg=as.factor(alg),link=as.numeric(link)) 

# display
acc_dat %>% 
  tbl_strata(
    strata = alg,
    .tbl_fun =
      ~ .x %>%
      tbl_summary(by = link,
        type = list(acc ~ 'continuous'),
    statistic = list(all_continuous() ~ "{mean}({sd})"),
    digits = list(acc ~ c(3, 3))),
    .header = "**{strata}**" 
  ) %>% # convert to kableExtra
  as_kable_extra(booktabs = TRUE, caption = "Acc Comparison") %>%
  # reduce font size to make table fit. 
  kableExtra::kable_styling(full_width = T, font_size = 7)
```

```{r}
# sec vs acc
sec_dat <- as.data.frame(cbind(new_alg$sec,ncd$sec,logis$time, new_alg$link)) %>% 
  set_names(c('new','ncd','logis','link')) %>% 
  pivot_longer(c(new,ncd,logis), names_to = 'alg',values_to = 'sec') %>%
  mutate(sec=as.numeric(sec),alg=as.factor(alg),link=as.numeric(link)) 

sec_acc_dat <- bind_cols(acc_dat,sec_dat,.name_repair = 'minimal') 

sec_acc_dat[,-c(4,5)] %>% ggplot(aes(x=acc,y=sec,color=alg)) +
  geom_line()
```

